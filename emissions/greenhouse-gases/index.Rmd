---
pagetitle: "Greenhouse gas emissions"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, out.width = "100%", dev = "svg")

library(tidyverse) ; library(lubridate) ; library(ggtext) ; library(downloadthis)

df <- read_csv("data/data.csv") %>% 
  pivot_longer(-Year, names_to = "Measure", values_to = "Value") %>%
  mutate(Year = ymd(Year, truncated = 2L),
         Measure = fct_relevel(Measure, "Territorial", "Residence", "Consumption"))
```

```{r}
plot <- ggplot(df, aes(x = Year, y = Value, colour = Measure)) +
  geom_line(linewidth = 1) +
  scale_x_date(expand = c(0.005, 0.005),
               breaks = seq(as.Date("1990-01-01"), as.Date("2022-01-01"), by = "3 years"),
               date_labels = "%Y") +
  scale_y_continuous(expand = c(0.005, 0.005), 
                     limits = c(400, NA),
                     position = "right") +
  scale_colour_manual(values = c("#206095", "#27A0cc", "#871a5b")) +
  labs(x = NULL, y = "Mt CO<sub>2</sub>e", colour = NULL,
       title = "Consumption emissions are falling at a slower rate<br><span style = 'font-size:10pt;color:#757575;'>Greenhouse gas emissions on a <span style = 'color:#206095;'>territorial</span>, <span style = 'color:#27A0cc;'>residence</span> and <span style = 'color:#871a5b;'>consumption</span> basis<br>United Kingdom, 1990-2022</span>",
       caption = "Source: DESNZ, ONS, DEFRA") +
  theme_minimal(base_size = 12) +
  theme(plot.margin = unit(rep(0.5, 4), "cm"),
        panel.grid.major.x = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line.x = element_line(colour = "#000000"),
        plot.title.position = "plot",
        plot.title = element_textbox(size = 15, lineheight = 1, width = unit(0.8, "npc"), margin = margin(b = 20)),
        plot.caption = element_text(colour = "grey60", margin = margin(t = 10), size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y.right = element_markdown(size = 8, angle = 0, vjust = 1, margin = margin(l = -20)),
    legend.position = "bottom")
plot
```

<hr>

#### Downloads

```{r}
plot %>% 
  download_this( 
    output_name = "plot",
    output_extension = ".png",
    button_label = "Chart",
    has_icon = TRUE,
    icon = "fas fa-chart-line"
    )
```

```{r}
download_file(
  path = "data/data.csv",
  output_name = "data",
  button_label = "Data",
  has_icon = TRUE,
  icon = "fas fa-file-csv",
  self_contained = FALSE
)
```

```{r}
download_file(
  path = "data/script.R",
  output_name = "script",
  button_label = "R code",
  has_icon = TRUE,
  icon = "fas fa-code",
  self_contained = FALSE
)
```

<br>

#### Further resources
- [Measuring UK greenhouse gas emissions](https://www.ons.gov.uk/economy/environmentalaccounts/methodologies/measuringukgreenhousegasemissions), Office for National Statistics (December 2023)